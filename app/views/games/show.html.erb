<p id="notice"><%= notice %></p>

<table>
  <tr>
    <th>Id</th>
    <th>Name</th>
    <th>White</th>
    <th>Black</th>
    <th>Event</th>
    <th>Date</th>
    <th>Site</th>
    <th>Halfturns</th>
    <th>Result</th>
    <th>Mode</th>
  </tr>
  <% white = @game.whitePlayer  %>
  <% black = @game.blackPlayer %>
  <% event = @game.event %>
  <tr>
    <td><%= @game.id %></td>
    <td><%= @game.name %></td>
    <td><%= link_to white.name, white %></td>
    <td><%= link_to black.name, black %></td>
    <td><%= link_to event.name, event %></td>
    <td><%= @game.date %></td>
    <td><%= @game.site %></td>
    <td><%= @game.halfturns %></td>
    <td><%= @game.result %></td>
    <td><%= @game.mode %></td>
  </tr>
</table>

<% positions = @game.positionLinks %>
<% nHalfturns = 0 %>
<p>Game Moves</p>

<table>
  <% k=0 %>
  <% positions.each do |pos| %>
 
    <% if k%2 ==0 %>
     <tr>
      <td><%="#{1+(k/2)}."%></td>
      <% if pos.end_node.id == @position.id %>
        <% nHalfturns = pos.nHalfturns %>
        <td><b><%= link_to pos.move, position_game_path(pos.end_node,@game) %></b></td>
      <% else %>
        <td><%= link_to pos.move, position_game_path(pos.end_node,@game) %></td>
      <% end %>
    <% else %>
      <% if pos.end_node.id == @position.id %>
        <td><b><%= link_to pos.move, position_game_path(pos.end_node,@game) %></b></td>
        <% nHalfturns = pos.nHalfturns %>
      <% else %>
        <td><%= link_to pos.move, position_game_path(pos.end_node,@game) %></td>
      <% end %>
     </tr>
    <% end %>
    <% k+=1 %>
  <% end %>
  <% if k%2!=0 %>
    <td></td>
   </tr>
  <% end %>
</table>

<p>
  <b>Navigation</b>
  </br>
  <% if nHalfturns > 0 %>
    <%= link_to 'Start', position_game_path(positions.first.end_node,@game) %>, 
    <%= link_to 'Backward', position_game_path(positions[nHalfturns-1].end_node,@game) %>, 
  <% else %>
    Start, Backward, 
  <% end %>
  <% if nHalfturns+1 < @game.halfturns %>
    <%= link_to 'Forward', position_game_path(positions[nHalfturns+1].end_node,@game) %>, 
    <%= link_to 'End', position_game_path(positions.last.end_node,@game) %>
  <% else %>
    Forward, End
  <% end %>
</p>

<%= render "positions/show", :object => @position %>